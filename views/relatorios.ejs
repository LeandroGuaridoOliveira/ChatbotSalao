<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Relatórios de Agendamentos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 40px;
    }
    h1 {
      color: #7e57c2;
    }
    form {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px #ccc;
      margin-bottom: 30px;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
    }
    label {
      font-weight: bold;
      color: #555;
    }
    input, select {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      min-width: 160px;
    }
    button {
      background-color: #7e57c2;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 2px 6px #ccc;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #ede7f6;
      color: #5e35b1;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .resumo {
      margin-top: 20px;
      font-weight: bold;
      color: #444;
    }
    a {
      color: #7e57c2;
      text-decoration: none;
      margin-top: 20px;
      display: inline-block;
    }
  </style>
</head>
<body>

  <h1>Relatórios de Agendamentos</h1>

  <form method="get" action="/relatorios">
    <div>
      <label for="dataInicio">Data Início:</label><br>
      <input type="date" name="dataInicio" id="dataInicio" value="<%= filtros.dataInicio || '' %>">
    </div>

    <div>
      <label for="dataFim">Data Fim:</label><br>
      <input type="date" name="dataFim" id="dataFim" value="<%= filtros.dataFim || '' %>">
    </div>

    <div>
      <label for="funcionario_id">Funcionário:</label><br>
      <select name="funcionario_id" id="funcionario_id">
        <option value="">Todos</option>
        <% funcionarios.forEach(f => { %>
          <option value="<%= f.id %>" <%= filtros.funcionario_id == f.id ? 'selected' : '' %>>
            <%= f.nome %> - <%= f.especialidade %>
          </option>
        <% }) %>
      </select>
    </div>

    <div>
      <label for="procedimento_id">Procedimento:</label><br>
      <select name="procedimento_id" id="procedimento_id">
        <option value="">Todos</option>
        <% procedimentos.forEach(p => { %>
          <option value="<%= p.id %>" <%= filtros.procedimento_id == p.id ? 'selected' : '' %>><%= p.nome %></option>
        <% }) %>
      </select>
      
    </div>

    <div style="align-self: flex-end;">
      <button type="submit">Filtrar</button>
    </div>
  </form>

  <% if (agendamentos.length === 0) { %>
    <p>Nenhum agendamento encontrado para os filtros selecionados.</p>
  <% } else { %>

    <%
function formatarDataBR(dataISO) {
  const [ano, mes, dia] = dataISO.split('-');
  return `${dia}/${mes}/${ano}`;
}
%>

<table>
  <thead>
    <tr>
      <th>Cliente</th>
      <th>Funcionário</th>
      <th>Procedimentos</th>
      <th>Valor Total</th>
      <th>Data</th>
      <th>Horário</th>
    </tr>
  </thead>
  <tbody>
    <% agendamentos.forEach(a => { %>
      <tr>
        <td><%= a.cliente_nome %></td>
        <td><%= a.funcionario_nome %></td>
        <td><%= a.procedimentos || 'Nenhum' %></td>
        <td>R$ <%= (a.valor_total || 0).toFixed(2) %></td>
        <td><%= a.dia %></td>
        <td><%= a.horario %></td>
      </tr>
    <% }) %>
  </tbody>
</table>


    <div class="resumo">
      <p>Total de agendamentos: <%= agendamentos.length %></p>
      <p>Soma total: R$ <%= agendamentos.reduce((acc, a) => acc + (a.valor_total || 0), 0).toFixed(2) %></p>
    </div>
  <% } %>

  <a href="/agendamentos">&larr; Voltar</a>

</body>
</html>
